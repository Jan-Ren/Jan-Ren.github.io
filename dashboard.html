<html>
    <head>
        <meta charset="utf-8"/>
        <style>
            div.container{
                position: relative;
            }
            div.menu{
                width:100%;
                height: 100px;
                display: flex;
                flex-grow: 1;
                background-color: green;
                background-image: url('assets/menuBackground.jpg');
                background-size: 100% 100%;
            }
            div > li{
                list-style: none;
                display: inline-block;
                padding: 10px;
            }
            div#tableofsales{
                float: right;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class= "menu">
                <li>
                    Upload a JSON file.
                </li>
                <li id="upload">
                    <input type="file" id="selectFiles" value="Import" /><br />
                    <button id="import">Import</button>
                </li>
                <li>
                    <!--Design-->
                </li>
            </div>
        
            <br>
        
            <div class= "charts">
                <div id ="chartDoughnutContainerKrabbyPattie" style="height: 300px; width: 100%;"></div>
                <div id ="chartDoughnutContainerKrabbyDeluxe" style="height: 300px; width: 100%;"></div>
                <div id ="chartDoughnutContainerKrabbyCombo" style="height: 300px; width: 100%;"></div>
                <div id="chartColumnContainer" style="height: 300px; width: 100%;"></div>
                <div id="chartBarContainer" style="height: 300px; width: 100%;"></div>
            </div>
            <h1>Filter Date</h1>
            <input type = "text" id = "startdate"> to
            <input type = "text" id = "enddate">
            <div id= "tableofsales">
                <table align = "center" border = 1px id = "tbler">
                    <tr>
                        <th>Date</th>
                        <th>Burger</th>
                        <th>Species</th>
                    </tr>
                </table>
            </div>
            <div>
                <!--just put your filters here-->
            </div>
        </div>
        
        <!-- JAVASCRIPT -->
        
        <script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
        <link rel = "stylesheet" href = "jquery.datetimepicker.min.css">
        <script src = "jquery.js"></script>
        <script src = "jquery.datetimepicker.full.min.js"></script>
        <script type="text/javascript">
        
            
        var result; // GLOBAL VARIABLE OF THE JSON OBJECT
        var tablecr;
        var arr2 = []; // ALL SALES
        var arr3 = []; //FILTERED SALES
        
            //clears the values from the text input box
        $("#startdate").val("")
        $("#enddate").val("")
        //This reads the uploaded jsonfile
        document.getElementById('import').onclick = function() {
            //serves as a function to make a date and time picker on the text input boxes
            $("#startdate").datetimepicker()
            $("#enddate").datetimepicker()
            
            var files = document.getElementById('selectFiles').files;
            console.log(files);
            if (files.length <= 0) {
                return false;
            }
            var fr = new FileReader();
            fr.onload = function(e) { 
                console.log("Hello world");
                console.log(e);
                
                result = JSON.parse(e.target.result);
                var chen = Object.values(result.sales);
                drawColumnChart(getBurgerSales());//calls function draw ColumnChart
                drawBarGraph(getSpeciesSales()); // calls function draw BarGraph
                drawDoughnutChartKrabbyPattie(getKrabbyPattieSpecie())// calls function Doughnut Graph
                drawDoughnutChartKrabbyDeluxe(getKrabbyDeluxeSpecie())// calls function Doughnut Graph
                drawDoughnutChartKrabbyCombo(getKrabbyComboSpecie())// calls function Doughnut Graph
                drawTable();    //calls function table
                //var sample = Object.values(result.burger_by_species)[0];
            
                //console.log(Object.values(sample)[0])
                //console.log(Object.values(result.sales)[0]);
                
                //console.log(Object.values(chen).length);
                /*
                var array = [];
                
                for (let i = 0; i < Object.keys(result.sales).length; i++) {
                    array.push(Object.values(result.sales)[i]);
                }
                
                console.log(array[2].burger);
                */
                           }
            
            fr.readAsText(files.item(0));
            //event when the values of the input text boxes are changed
            $("#startdate").change(function() {
                
                
                filtersequence()
                
            })
            $("#enddate").change(function() {
                filtersequence()
                
            })
            
            
        };
            //calls the sequence of the filtering of table starting from startdate to enddate
        function filtersequence() {
            let startdate2 = $.trim($("#startdate").val())
            let enddate2 = $.trim($("#enddate").val())
            clearrows()
            arr3 = arr2
            if (startdate2 != "" || enddate2 != "") {
                if (startdate2 != "") {
                
                    console.log("Jun")
                    filteredstartdaterows()
                }
                
                if (enddate2 != "") {
                
                    console.log("Jan")
                    filteredenddate()
                }
            }
            else {
                drawTable()
            }
            addrows()
            arr3 = []
        }
      
        //erases the rows below the header
        function clearrows() {
            let rownumb = $("#tbler tr").length
            for (let i = 2; i <= rownumb; i++) {
                let numleft = $("#tbler tr").length;
                if (numleft != 1) {
                    document.getElementById("tbler").deleteRow(1)
                }
                
            }
        }
            //filters the array of sales(arr3) that has a date equivalent or greater than the selected startdate
        function filteredstartdaterows() {
            console.log("Start date")
            let arr4 = []
            let year1 = $("#startdate").val().substring(0, 4), year2
            let month1 = $("#startdate").val().substring(5, 7), month2
            let day1 = $("#startdate").val().substring(8, 10), day2
            let hour1 = $("#startdate").val().substring(11, 13), hour2
            let min1 = $("#startdate").val().substring(14, 16), min2
            for (let i = 0; i < arr3.length; i++) {
                year2 = arr3[i].datetime.substring(0, 4)
                month2 = arr3[i].datetime.substring(5, 7)
                day2 = arr3[i].datetime.substring(8, 10)
                hour2 = arr3[i].datetime.substring(11, 13)
                min2 = arr3[i].datetime.substring(14, 16)
                
                
                if (parseInt(year1) == parseInt(year2)){
                    
                    if (parseInt(month2) == parseInt(month1)) {
                        if (parseInt(day1) == parseInt(day2)) {
                            if (parseInt(hour1) == parseInt(hour2)) {
                                if (parseInt(min1) <= parseInt(min2)) {
                                    arr4.push(arr3[i]) 
                                }
                                
                            }
                            else if (parseInt(hour1) < parseInt(hour2)) {
                                arr4.push(arr3[i]) 
                            }  
                        }
                        else if (parseInt(day1) < parseInt(day2)) {
                            arr4.push(arr3[i]) 
                        }    
                        
                    }
                    else if (parseInt(month1) < parseInt(month2)) {
                        arr4.push(arr3[i]) 
                    }   
                }
                else if (parseInt(year1) < parseInt(year2)) {
                    arr4.push(arr3[i])    
                }
            }
            
            arr3 = []
            arr3 = arr4
            
                
        }
            //filters the array of dates(arr3) that has a date which is equivalent or less than the selected enddate
        function filteredenddate() {
            let arr4 = []
            console.log("end " + arr3.length)
            let year1 = $("#enddate").val().substring(0, 4), year2
            let month1 = $("#enddate").val().substring(5, 7), month2
            let day1 = $("#enddate").val().substring(8, 10), day2
            let hour1 = $("#enddate").val().substring(11, 13), hour2
            let min1 = $("#enddate").val().substring(14, 16), min2
            for (let i = 0; i < arr3.length; i++) {
                year2 = arr3[i].datetime.substring(0, 4)
                month2 = arr3[i].datetime.substring(5, 7)
                day2 = arr3[i].datetime.substring(8, 10)
                hour2 = arr3[i].datetime.substring(11, 13)
                min2 = arr3[i].datetime.substring(14, 16)
                
                
                if (parseInt(year1) == parseInt(year2)){
                    
                    if (parseInt(month2) == parseInt(month1)) {
                        if (parseInt(day1) == parseInt(day2)) {
                            if (parseInt(hour1) == parseInt(hour2)) {
                                if (parseInt(min1) >= parseInt(min2)) {
                                    arr4.push(arr3[i]) 
                                }
                                
                            }
                            else if (parseInt(hour1) > parseInt(hour2)) {
                                arr4.push(arr3[i]) 
                            }  
                        }
                        else if (parseInt(day1) > parseInt(day2)) {
                            arr4.push(arr3[i]) 
                        }    
                        
                    }
                    else if (parseInt(month1) > parseInt(month2)) {
                        arr4.push(arr3[i]) 
                    }   
                }
                else if (parseInt(year1) > parseInt(year2)) {
                    arr4.push(arr3[i])    
                }
            }
            
            arr3 = []
            arr3 = arr4
        }
      
        //gets the burgersales data
        function getBurgerSales(){
            
            var arrayBurger_sales = []
         
            for(let i = 0; i < Object.keys(result.burger_sales).length; i++){
                arrayBurger_sales.push(Object.values(result.burger_sales)[i]);
                
            };
            return arrayBurger_sales;
        }
        //gets the species sales data
        function getSpeciesSales(){
            
            var arraySpecies_sales = []
            
            for(let i = 0; i < Object.keys(result.species_sales).length; i++){
                arraySpecies_sales.push(Object.values(result.species_sales)[i]);
            };
            return arraySpecies_sales;
        }
        //gets the burgers by species data (KRABBY PATTIE)
        function getKrabbyPattieSpecie(){
            
            var krabbypattie = Object.values(result.burger_by_species)[1];
            return krabbypattie;
        }
        //gets the burgers by species data (DELUXE)
        function getKrabbyDeluxeSpecie(){
            
            var krabbydeluxe = Object.values(result.burger_by_species)[2];
            
            return krabbydeluxe;
        }
        //gets the burgers by species data (COMBO)
        function getKrabbyComboSpecie(){
            
            var krabbycombo= Object.values(result.burger_by_species)[0];
            
            return krabbycombo;
        }
        //column chart
        function drawColumnChart(array) {
            console.log("Check " + Object.values(result)[0]);
        	var chart = new CanvasJS.Chart("chartColumnContainer", {
        		title:{
        			text: "Burger Sales"              
        		},
        		data: [              
        		{
        			// Change type to "doughnut", "line", "splineArea", etc.
        			type: "column",
                   
        			dataPoints: [
        				{ label: "Krusty Combo",  y: array[0]},
        				{ label: "Krusty Deluxe", y: array[1]},
        				{ label: "Krabby Pattie", y: array[2]}
        			]
        		}
        		]
        	});
        	chart.render();
        }
        //DoughnutChart(Krabby Pattie)
        function drawDoughnutChartKrabbyPattie(array) {
            var chart = new CanvasJS.Chart("chartDoughnutContainerKrabbyPattie",
            {
              title:{
                text: "Krabby Pattie Sales by Species"  
              },
              data: [
              {
               type: "doughnut",
               dataPoints: [
               {  y: getPercentage(Object.values(array)[0], getTotal(array)), indexLabel: "leatherback turtle" },
               {  y: getPercentage(Object.values(array)[1], getTotal(array)), indexLabel: "salmon"},
               {  y: getPercentage(Object.values(array)[2], getTotal(array)), indexLabel: "seahorse"},
               {  y: getPercentage(Object.values(array)[3], getTotal(array)), indexLabel: "coral" },
               {  y: getPercentage(Object.values(array)[4], getTotal(array)), indexLabel: "giant clam" },
               {  y: getPercentage(Object.values(array)[5], getTotal(array)), indexLabel: "gray whale" },
               {  y: getPercentage(Object.values(array)[6], getTotal(array)), indexLabel: "sea lion" }
               ]
             }
             ]
           });
       
            chart.render();
          }
        //DoughnutChart(Krabby Deluxe)
        function drawDoughnutChartKrabbyDeluxe(array) {
            var chart = new CanvasJS.Chart("chartDoughnutContainerKrabbyDeluxe",
            
            {
              title:{
                text: "Krabby Deluxe Sales by Species"  
              },
              data: [
              {
               type: "doughnut",
               dataPoints: [
               {  y: getPercentage(Object.values(array)[0], getTotal(array)), indexLabel: "leatherback turtle" },
               {  y: getPercentage(Object.values(array)[1], getTotal(array)), indexLabel: "salmon"},
               {  y: getPercentage(Object.values(array)[2], getTotal(array)), indexLabel: "seahorse"},
               {  y: getPercentage(Object.values(array)[3], getTotal(array)), indexLabel: "coral" },
               {  y: getPercentage(Object.values(array)[4], getTotal(array)), indexLabel: "giant clam" },
               {  y: getPercentage(Object.values(array)[5], getTotal(array)), indexLabel: "gray whale" },
               {  y: getPercentage(Object.values(array)[6], getTotal(array)), indexLabel: "sea lion" }
               ]
             }
             ]
           });
       
            chart.render();
          }
        //DoughnutChart(Krabby Combo)
        function drawDoughnutChartKrabbyCombo(array) {
            var chart = new CanvasJS.Chart("chartDoughnutContainerKrabbyCombo",
            
            {
              title:{
                text: "Krabby Combo Sales by Species"  
              },
              data: [
              {
               type: "doughnut",
               dataPoints: [
               {  y: getPercentage(Object.values(array)[0], getTotal(array)), indexLabel: "leatherback turtle" },
               {  y: getPercentage(Object.values(array)[1], getTotal(array)), indexLabel: "salmon"},
               {  y: getPercentage(Object.values(array)[2], getTotal(array)), indexLabel: "seahorse"},
               {  y: getPercentage(Object.values(array)[3], getTotal(array)), indexLabel: "coral" },
               {  y: getPercentage(Object.values(array)[4], getTotal(array)), indexLabel: "giant clam" },
               {  y: getPercentage(Object.values(array)[5], getTotal(array)), indexLabel: "gray whale" },
               {  y: getPercentage(Object.values(array)[6], getTotal(array)), indexLabel: "sea lion" }
               ]
             }
             ]
           });
       
            chart.render();
          }
        //bar Graph
        function drawBarGraph(array) {
        	var chart = new CanvasJS.Chart("chartBarContainer", {
        		title:{
        			text: "Species Sales"              
        		},
        		data: [              
        		{
        			// Change type to "doughnut", "line", "splineArea", etc.
        			type: "bar",
        			dataPoints: [
        				{ label: "leatherback turtle",  y: array[0]},
        				{ label: "salmon", y: array[1]},
                        { label: "seahorse", y: array[2]},
                        { label: "coral", y: array[3]},
                        { label: "giant clam", y: array[4]},
                        { label: "gray whale", y: array[5]},
                        { label: "sea lion", y: array[6]}
        			]
        		}
        		]
        	});
        	chart.render();
        }
            
        function drawTable() {
            console.log("Table");
              
            
            for (let i = 0; i < Object.keys(result.sales).length; i++) {
               arr2.push(Object.values(result.sales)[i]);   //places the array data from the sales array 
            }
            arr3 = arr2;
            console.log("Checker " + arr2.length);
            addrows();
            
         
        }
            //add the values of array arr3 in a row
        function addrows() {
            var tbl = document.getElementById("tbler"); 
            for (let j = 0; j < arr3.length; j++) {
             var row = tbl.insertRow();             //for every loop, a row will be initialized
                var cel1 = row.insertCell();        //adder of a cell in each column
                var cel2 = row.insertCell();
                var cel3 = row.insertCell();
                
                cel1.innerHTML = arr3[j].datetime;  //places the string from the array according to the specific variable
                cel2.innerHTML = arr3[j].burger;
                cel3.innerHTML = arr3[j].species;
        }
            arr3 = []
            console.log(arr3.length + " length")
        }
        //Gets percentage value
        function getPercentage(value, total){
            let percent = value / total;
            percent = percent*100;
            return percent;
        }
        // gets total value of a json object
        function getTotal(array){
            let sum = 0;
            for(let i = 0; i < Object.keys(array).length; i++) {
               sum = sum + Object.values(array)[i];
            }
            return sum;
        }     
        </script>
        
    </body>
</html>
